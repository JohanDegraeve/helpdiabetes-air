<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (C) 2011  hippoandfriends

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/gpl.txt>.

-->
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark" title="SettingsBolusCalculationView">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Metadata>
		[ResourceBundle("settingsview")]
		[ResourceBundle("general")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
			import databaseclasses.Settings;
			
			import model.ModelLocator;
			
			import mx.managers.PopUpManager;
			
			import myComponents.AmountPicker;
			import myComponents.PickerEvent;
			
			private function breakfastSettingClicked(event:Event):void  {
				var amountPicker:AmountPicker = new AmountPicker();
				amountPicker.labelText = "hello";
				amountPicker.amount = parseFloat(Settings.getInstance().getSetting(Settings.SettingINSULIN_RATIO_BREKFAST));
				amountPicker.addEventListener(PickerEvent.PICKER_SET, onAmountSet);
				amountPicker.addEventListener(PickerEvent.PICKER_CANCEL, onAmountCancel);
				PopUpManager.addPopUp(amountPicker, this, true);
				PopUpManager.centerPopUp(amountPicker);
				
				function onAmountCancel(event: PickerEvent): void
				{
					amountPicker.removeEventListener(PickerEvent.PICKER_SET, onAmountSet);
					amountPicker.removeEventListener(PickerEvent.PICKER_CANCEL, onAmountCancel);
				}
				
				function onAmountSet(event: PickerEvent): void
				{
					amountPicker.removeEventListener(PickerEvent.PICKER_SET, onAmountSet);
					amountPicker.removeEventListener(PickerEvent.PICKER_CANCEL, onAmountCancel);
					Settings.getInstance().setSetting(Settings.SettingINSULIN_RATIO_BREKFAST,(event.newValue as Number).toString());
					breakfastRatio.text = (event.newValue as Number).toString();
				}
			}
		]]>
	</fx:Script>
	<s:navigationContent>
		<s:Button label="Back" id="backButton" click="navigator.popView()"/>
	</s:navigationContent>
	<s:Group y="0" x="0" width="100%" height = "100%" >
		<s:layout>
			<s:VerticalLayout>
			</s:VerticalLayout>
		</s:layout>
		<s:Group id="breakfastSetting" y="0" x="0" width="100%" height = "100%" click="breakfastSettingClicked(event)">
			<s:layout>
				<s:HorizontalLayout>
				</s:HorizontalLayout>
			</s:layout>
			<s:TextArea width="60%" text="{resourceManager.getString('general','breakfast') + ' :'}" editable="false"/>
			<s:TextArea id="breakfastRatio" width="40%" text="{Settings.getInstance().getSetting(Settings.SettingINSULIN_RATIO_BREKFAST)}" editable="false"/>
		</s:Group>
	</s:Group>
</s:View>
