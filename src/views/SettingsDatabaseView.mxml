<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark"
		initialize="onInit()">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Metadata>
		[ResourceBundle("general")]
		[ResourceBundle("settingsdatabaseview")]
	</fx:Metadata>
	<fx:Script>
		<![CDATA[
			import com.google.analytics.AnalyticsTracker;
			
			import databaseclasses.Settings;
			
			import mx.managers.PopUpManager;
			
			import myComponents.AmountPicker;
			import myComponents.PickerEvent;
			
			import utilities.MyGATracker;
			
			private var amountPicker:AmountPicker;

			private var thisView:View;
		
			[Bindable]
			private var back_label:String;
			
			public var tracker:AnalyticsTracker;
			private var trackerId:String;
			
			private function onInit():void {
				back_label = resourceManager.getString('general','back');
				trackerId = resourceManager.getString('analytics','trackeraccount');
				thisView = this;
			}
			
			private function trackingSizeClicked(event:Event):void  {
				amountPicker = new AmountPicker();
				amountPicker.amount = Settings.getInstance().getSetting(Settings.SettingsMAXTRACKINGSIZE);
				amountPicker.maxNonDecimalDigits = 3;
				amountPicker.decimalDigits = 0;
				//amountPicker.labelText1 = resourceManager.getString('editmedicineventview','amount_of_units');
				amountPicker.addEventListener(PickerEvent.PICKER_SET, onAmountSet);
				amountPicker.addEventListener(PickerEvent.PICKER_CANCEL, onAmountCancel);
				
				PopUpManager.addPopUp(amountPicker, this, true);
				PopUpManager.centerPopUp(amountPicker);
				
				function onAmountCancel(event: PickerEvent): void
				{
					amountPicker.removeEventListener(PickerEvent.PICKER_SET, onAmountSet);
					amountPicker.removeEventListener(PickerEvent.PICKER_CANCEL, onAmountCancel);
				}
				
				function onAmountSet(event: PickerEvent): void
				{
					if (tracker == null) {
						tracker = new MyGATracker( thisView, trackerId, "AS3", false );
					}
					tracker.trackPageview( "SettingsDatabaseView-trackingSizeChanged" );

					amountPicker.removeEventListener(PickerEvent.PICKER_SET, onAmountSet);
					amountPicker.removeEventListener(PickerEvent.PICKER_CANCEL, onAmountCancel);
					trackingsizeButton.label = (event.newValue as Number).toString();
					Settings.getInstance().setSetting(Settings.SettingsMAXTRACKINGSIZE,trackingsizeButton.label );
				}
			}
		]]>
	</fx:Script>
	<s:navigationContent>
		<s:Button   label="{back_label}" id="backButton" click="navigator.popView()" height="48"/>
	</s:navigationContent>
	<s:Group y="0" x="0" width="100%" left="5" top="5" right="5">
		<s:layout>
			<s:VerticalLayout>
			</s:VerticalLayout>
		</s:layout>
		<s:Group id="trackingsize" y="0" x="0" width="100%" height = "100%"  click="trackingSizeClicked(event)">
			<s:layout>
				<s:HorizontalLayout verticalAlign="middle">
				</s:HorizontalLayout>
			</s:layout>
			<s:Label  width="60%" text="{resourceManager.getString('settingsdatabaseview','trackingviewsize') }" />
			<s:Button id="trackingsizeButton" width="40%" label="{Settings.getInstance().getSetting(Settings.SettingsMAXTRACKINGSIZE)}"  />
		</s:Group>
	</s:Group>
</s:View>
